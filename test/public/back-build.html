<!DOCTYPE html>
<html>
<head>
	<title>Sample build and setup, back button, rebuild page</title>
	<script src="/polyfills/url.js"></script>
	<script src="/polyfills/promise.js"></script>
	<script src="/window-page.js"></script>
	<script>
	console.log("TOTO");
var nums = {
	build: 1,
	setup: 1
};
var reads = {};
Page.route(function(state) {
	console.log("ROUTE");
	// do nothing, prevents default route to fetch a remote document
	document.title = state.pathname;
});
Page.build(function(state) {
	console.log("build state");
});
Page.build(checkNums);
Page.setup(checkNums);

var numClicks = 0;
Page.setup(function(state) {
	console.log("setting up listener");
	document.body.addEventListener('click', function(e) {
		console.log("got click");
		e.target.innerText = ++numClicks;
	});
	if (state.pathname == "/back-build.html")	{
		console.log("change location", Page.format({pathname: "/inexistent.html"}));
		setTimeout(function() {
			Page.push({
				pathname: "/inexistent.html"
			});
		}, 50);
	}	else if (state.pathname == "/inexistent.html") {
		console.log("second page");
	}
});

window.simClick = function() {
	var e = new MouseEvent('click', {bubbles: true, cancelable: true});
	document.getElementById('click').dispatchEvent(e);
	console.log("click dispatched");
};

function checkNums(state) {
	var stage = state.stage;
	var node = document.querySelector('.' + stage);
	if (!reads[stage]) {
		reads[stage] = true;
		var int = parseInt(node.innerHTML);
		if (!isNaN(int)) nums[stage] = int;
	}
	node.innerHTML = nums[stage]++;
}
	</script>
</head>
<body>
<div id="once"></div>
<div class="build"></div>
<div class="patch"></div>
<div class="setup"></div>
<div id="query"></div>
<div id="loc"></div>
<div id="click"></div>
</body>
</html>
